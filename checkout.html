<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout - QuickBite</title>
<style>
  body { font-family: Arial; background: #fff5f8; padding: 20px; }
  h1 { text-align: center; color: #e91e63; margin-bottom: 20px; }
  .container { max-width: 600px; margin: auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
  ul { list-style: none; padding: 0; margin-bottom: 20px; }
  li { display: flex; justify-content: space-between; margin: 8px 0; }
  label { display: block; margin-top: 10px; font-weight: bold; }
  input { width: 100%; padding: 8px; margin-top: 4px; border-radius: 6px; border: 1px solid #ccc; }
  button { width: 100%; padding: 12px; background: #4caf50; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; margin-top: 15px; }
  button:hover { background: #45a049; }
  .total { font-weight: bold; font-size: 18px; margin-top: 15px; text-align: right; }
  .payment-options { display: flex; gap: 10px; margin-top: 10px; }
  .payment-option { flex: 1; border: 1px solid #ccc; border-radius: 8px; padding: 10px; text-align: center; cursor: pointer; transition: 0.3s; }
  .payment-option img { width: 40px; height: 40px; margin-bottom: 5px; }
  .payment-option:hover { border-color: #4caf50; background: #f0fff0; }
  .payment-option.selected { border-color: #4caf50; background: #e6ffe6; }
  #orderConfirmation { display: none; text-align: center; padding: 20px; }
  #orderConfirmation h2 { color: #4caf50; }
  #map { width: 100%; height: 250px; border-radius: 8px; margin-top: 10px; }
</style>

<!-- Google Maps API with Places Library -->
<script async
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBgISP1ilk8ULQOmA6WHYCX6etPIN_IUyI&libraries=places&callback=initMap">
</script>
</head>
<body>

<h1>ðŸ›’ Checkout</h1>
<div class="container" id="checkoutSection">
  <h2>Your Order</h2>
  <ul id="cartItems"></ul>
  <div class="total" id="totalBill"></div>

  <label for="address">Delivery Address:</label>
  <input type="text" id="address" placeholder="Enter your address" required>
  <button type="button" onclick="getLocation()">Use Current Location</button>

  <label>Confirm Location on Map:</label>
  <div id="map"></div>

  <label>Payment Method:</label>
  <div class="payment-options">
    <div class="payment-option" data-value="cash" onclick="selectPayment(this)">
      <img src="https://cdn-icons-png.flaticon.com/512/2331/2331941.png" alt="Cash">
      <div>Cash on Delivery</div>
    </div>
    <div class="payment-option" data-value="card" onclick="selectPayment(this)">
      <img src="https://cdn-icons-png.flaticon.com/512/196/196561.png" alt="Card">
      <div>Credit/Debit Card</div>
    </div>
    <div class="payment-option" data-value="upi" onclick="selectPayment(this)">
      <img src="https://cdn-icons-png.flaticon.com/512/825/825454.png" alt="UPI">
      <div>UPI</div>
    </div>
  </div>

  <button onclick="placeOrder()">Place Order</button>
</div>

<div class="container" id="orderConfirmation">
  <h2>âœ… Your order has been placed!</h2>
  <p>Thank you for ordering with <b>QuickBite</b>. Your delicious food is on the way ðŸš€</p>
</div>

<script>
let cart = JSON.parse(localStorage.getItem('cart')) || [];
let loggedIn = localStorage.getItem('loggedIn') === 'true';
const cartItemsEl = document.getElementById("cartItems");
const totalBillEl = document.getElementById("totalBill");
let selectedPayment = null;

// Show cart items and total
let subtotal = 0;
cart.forEach(item => {
  const li = document.createElement("li");
  li.textContent = `${item.name} x ${item.qty} - â‚¹${item.price * item.qty}`;
  cartItemsEl.appendChild(li);
  subtotal += item.price * item.qty;
});
let delivery = subtotal >= 300 ? 0 : 50;
let gst = Math.round(subtotal * 0.05);
let platformFee = 10;
let total = subtotal + delivery + gst + platformFee;
totalBillEl.textContent = `Total Bill: â‚¹${total}`;

// Payment option
function selectPayment(el) {
  document.querySelectorAll(".payment-option").forEach(opt => opt.classList.remove("selected"));
  el.classList.add("selected");
  selectedPayment = el.getAttribute("data-value");
}

// Place order
function placeOrder() {
  const address = document.getElementById('address').value;
  if(!loggedIn) { alert("Please login first."); window.location.href="login.html"; return; }
  if(!address) { alert("Enter delivery address."); return; }
  if(!selectedPayment) { alert("Select payment method."); return; }
  document.getElementById('checkoutSection').style.display='none';
  document.getElementById('orderConfirmation').style.display='block';
  localStorage.removeItem('cart');
}

// Google Maps variables
let map, marker, autocomplete;

function initMap() {
  const india = { lat: 20.5937, lng: 78.9629 };
  map = new google.maps.Map(document.getElementById('map'), { center: india, zoom: 5 });
  marker = new google.maps.Marker({ map: map, draggable: true });

  const input = document.getElementById('address');
  autocomplete = new google.maps.places.Autocomplete(input, { componentRestrictions: { country: 'in' } });
  autocomplete.addListener('place_changed', () => {
    const place = autocomplete.getPlace();
    if (!place.geometry) return;
    map.setCenter(place.geometry.location);
    map.setZoom(15);
    marker.setPosition(place.geometry.location);
  });

  marker.addListener('dragend', () => {
    const geocoder = new google.maps.Geocoder();
    geocoder.geocode({ location: marker.getPosition() }, (results, status) => {
      if (status === 'OK' && results[0]) input.value = results[0].formatted_address;
    });
  });
}

// Current location
function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(pos => {
      const coords = { lat: pos.coords.latitude, lng: pos.coords.longitude };
      const geocoder = new google.maps.Geocoder();
      geocoder.geocode({ location: coords }, (results, status) => {
        if (status === 'OK' && results[0]) document.getElementById('address').value = results[0].formatted_address;
        else document.getElementById('address').value = `${coords.lat},${coords.lng}`;
      });
      map.setCenter(coords); map.setZoom(15); marker.setPosition(coords);
    }, () => alert("Unable to fetch location."));
  } else alert("Geolocation not supported.");
}
function initMap() {
  if (!google || !google.maps) {  ` ``` 
    document.getElementById('map').innerHTML = "<p>Map cannot load right now.</p>";
    return;
  }
  const india = { lat: 20.5937, lng: 78.9629 };
  map = new google.maps.Map(document.getElementById('map'), { center: india, zoom: 5 });
  marker = new google.maps.Marker({ map: map, draggable: true });
  
  const input = document.getElementById('address');
  autocomplete = new google.maps.places.Autocomplete(input, { componentRestrictions: { country: 'in' } });
  autocomplete.addListener('place_changed', () => {
    const place = autocomplete.getPlace();
    if (!place.geometry) return;
    map.setCenter(place.geometry.location);
    map.setZoom(15);
    marker.setPosition(place.geometry.location);
  });

  marker.addListener('dragend', () => {
    const geocoder = new google.maps.Geocoder();
    geocoder.geocode({ location: marker.getPosition() }, (results, status) => {
      if (status === 'OK' && results[0]) input.value = results[0].formatted_address;
    });
  });
}

</script>

</body>
</html>
